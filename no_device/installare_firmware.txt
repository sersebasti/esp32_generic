#collega alla porta USB

# scopri porta usb:
ls /dev/ttyUSB* /dev/ttyACM*

# verifica esptool - se presente e da problemi per disinstallare
sudo apt remove esptool

# per installare esptool
sudo apt install pipx
pipx ensurepath
pipx install esptool

# per controllare versione esptool
esptool version

# per cancellare firmware
esptool --port /dev/ttyUSB0 erase-flash

# se non funziona potrebbe essere necessario entrare in modalità bootloader
➡️ tieni premuto BOOT
➡️ premi e rilascia RST/EN
➡️ rilascia BOOT

# installare firmware (mettere precorso completo del file .bin)
esptool --chip esp32 --port /dev/ttyUSB0 write-flash -z 0x1000 ESP32_GENERIC-20250911-v1.26.1.bin

# verifica se è installato mpremote
mpremote --help

# per installare mpremote (linux)
pipx install mpremote

# per vedere i file presenti
mpremote connect /dev/ttyUSB0 ls

# comando per cancellare tutti i files
mpremote connect /dev/ttyUSB0 rm -rv :

# comando per caricare i file della repo (tutti eccetto quelli non necessari)
find . -type f \
  ! -name "*.bin" \
  ! -name "*.txt" \
  ! -path "./.git/*" \
  ! -name "README.md" \
  -exec mpremote connect /dev/ttyUSB0 cp {} :{} \;

# per caricaro solo alcuni file e i file dento una cartella
mpremote connect COM5 cp main.py config.py wifi_api.py wifi_store.py http_consts.py http_utils.py wifi_ui.py system_api.py status_api.py wifi.json :
mpremote connect COM5 fs mkdir core
mpremote connect COM5 cp .\core\__init__.py .\core\busy_lock.py .\core\wifi_led_status.py .\core\wifi_store.py .\core\wifi_api.py .\core\logger.py .\core\server.py .\core\wifi_manager.py :/core

# per vedere i log sulla console
mpremote connect /dev/ttyUSB0 repl

# LANCIARE IN UNSEOCNDO MOMENTO 
mpremote connect COM5 exec "import core.uftpd as uftpd; uftpd.restart(port=21, verbose=0)"

