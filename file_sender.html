<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ESP32 FS Sender</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif; }
    body { margin: 20px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .row { display: flex; gap: 8px; align-items: center; margin: 8px 0; flex-wrap: wrap; }
    input[type="text"], input[type="file"] { padding: 6px; }
    button { padding: 8px 12px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; }
    .muted { color: #666; font-size: 12px; }
    pre { background: #f7f7f7; padding: 12px; border-radius: 8px; max-height: 50vh; overflow: auto; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>ESP32 FS Sender</h1>

  <div class="row">
    <label for="ip">IP ESP32:</label>
    <input id="ip" type="text" value="192.168.1.10" />
  </div>

  <div class="row">
    <input id="fileInput" type="file" />
    <button id="uploadBtn">Upload</button>
  </div>

  <div class="row">
    <button id="statusBtn">Status</button>
    <button id="rebootBtn">Reboot</button>
  </div>

  <div class="row">
    <span id="status" class="muted">Pronto.</span>
  </div>

  <h2 style="font-size:16px;margin-top:12px;">Risultato</h2>
  <pre id="result">(nessuna azione ancora)</pre>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const ipEl = $('#ip');
    const fileEl = $('#fileInput');
    const statusEl = $('#status');
    const resultEl = $('#result');

    function base() {
      const ip = ipEl.value.trim();
      if (!ip) throw new Error('IP non valido');
      return `http://${ip}`;
    }

    async function fetchText(url, opts={}) {
      const r = await fetch(url, opts);
      const txt = await r.text();
      if (!r.ok) throw new Error("HTTP " + r.status + " " + txt);
      return txt;
    }

    $('#uploadBtn').addEventListener('click', async () => {
      try {
        const file = fileEl.files[0];
        if (!file) {
          alert("Seleziona un file locale prima!");
          return;
        }
        const url = `${base()}/fs/upload?to=/${encodeURIComponent(file.name)}`;
        statusEl.textContent = "Upload in corso...";
        const txt = await fetchText(url, { method: "POST", body: file });
        resultEl.textContent = txt;
        statusEl.textContent = "Upload completato.";
      } catch (err) {
        statusEl.textContent = "Errore: " + err.message;
      }
    });

    $('#statusBtn').addEventListener('click', async () => {
      try {
        statusEl.textContent = "Richiesta status...";
        const txt = await fetchText(`${base()}/status`);
        resultEl.textContent = txt;
        statusEl.textContent = "Status ricevuto.";
      } catch (err) {
        statusEl.textContent = "Errore: " + err.message;
      }
    });

    $('#rebootBtn').addEventListener('click', async () => {
      try {
        statusEl.textContent = "Invio reboot...";
        const txt = await fetchText(`${base()}/reboot`, { method: "POST" });
        resultEl.textContent = txt;
        statusEl.textContent = "Reboot inviato (il device si riavvier√†).";
      } catch (err) {
        statusEl.textContent = "Errore: " + err.message;
      }
    });
  </script>
</body>
</html>
